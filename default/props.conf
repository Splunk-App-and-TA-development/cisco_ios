######################################################
#
# Cisco IOS
#
#
# Copyright (C) 2013 Mikael Bjerkeland
# All Rights Reserved
#
######################################################

[cisco:ios]
LOOKUP-cisco_ios-severity = cisco_ios_severity severity_id OUTPUT severity,severity_name,severity_description
LOOKUP-cisco_ios-vendor_action = cisco_ios_actions vendor_action AS acl_action OUTPUT action
LOOKUP-cisco_ios-vendor = cisco_ios_vendor sourcetype OUTPUT vendor
LOOKUP-cisco_ios-app_type = cisco_ios_apptype sourcetype OUTPUT app
REPORT-cisco_ios-general = extract_cisco_ios-general
EVAL-reliable_time = if(reliable_time == "*", "false", "true")
REPORT-cisco_ios-acl = extract_cisco_ios-acl
REPORT-cisco_ios-cdp_duplex_mismatch = extract_cisco_ios-duplex_mismatch
REPORT-cisco_ios-dot1x_switch_err_vlan_not_found = extract_cisco_ios-dot1x_switch_err_vlan_not_found
REPORT-cisco_ios-dot1x_auth = extract_cisco_ios-dot1x_auth
REPORT-cisco_ios-mab_auth = extract_cisco_ios-mab_auth 
REPORT-cisco_ios-authmgr_fail_success = extract_cisco_ios-authmgr_fail_success
REPORT-cisco_ios-authmgr_start = extract_cisco_ios-authmgr_start
REPORT-cisco_ios-authmgr_vlanassign = extract_cisco_ios-authmgr_vlanassign

REPORT-cisco_ios-dhcp_snooping_match_mac_fail = extract_cisco_ios-dhcp_snooping_match_mac_fail
REPORT-cisco_ios-sff8472_threshold-violation = extract_cisco_ios-sff8472_threshold-violation

REPORT-cisco_ios-ssh_ssh2_session = extract_cisco_ios-ssh_ssh2_session
REPORT-cisco_ios-ssh_ssh2_userauth = extract_cisco_ios-ssh_ssh2_userauth
REPORT-cisco_ios-link_error = extract_cisco_ios-link_error

# SMI/Smart Install
REPORT-cisco_ios-smi_upgrd = extract_cisco_ios-smi_upgrd
REPORT-cisco_ios-smi_switch_add = extract_cisco_ios-smi_switch_add
REPORT-cisco_ios-smi_switch_remove = extract_cisco_ios-smi_switch_remove

# DTP
REPORT-cisco_ios-dtp_domaimismatch = extract_cisco_ios-dtp_domainmismatch
REPORT-cisco_ios-dtp_trunkporton = extract_cisco_ios-dtp_trunkporton


# HSRP
REPORT-cisco_ios-standby_statechange = extract_cisco_ios-standby_statechange

# IP DUPADDR
REPORT-cisco_ios-ip_dupaddr = extract_cisco_ios-ip_dupaddr
REPORT-cisco_ios-ip_snmp_notrapip = extract_cisco_ios-ip_snmp_notrapip


# IPACCESSLOGS
EXTRACT-cisco_ios-acl-2 = IPACCESSLOGS: list (?<acl_list>.+) (?<acl_action>denied|permitted) (?<acl_src_ip>\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b) (?<acl_packets>\d+) packets

EXTRACT-cisco_ios-cdp_native_vlan-mismatch = %CDP-4-NATIVE_VLAN_MISMATCH: Native VLAN mismatch discovered on (?<cdp_local_interface>[^ ]+)\s\((?<cdp_local_vlan>\d+)\),\swith\s(?<cdp_neighbor>[^ ]+)\s(?<cdp_remote_interface>[^ ]+)\s\((?<cdp_remote_vlan>\d+)\)
EXTRACT-cisco_ios-link_updown = %LINK-3-UPDOWN: Interface (?<interface>\S+), changed state to (?<port_status>up|down|administratively down)
EXTRACT-cisco_ios-lineproto_updown = %LINEPROTO-5-UPDOWN: Line protocol on Interface (?<interface>\S+), changed state to (?<port_status>up|down|administratively down)
EXTRACT-cisco_ios-pm_err_disable = ERR_DISABLE:\s(?<disable_cause>.+)\serror\sdetected\s\on\s(?<detected_on_interface>.+),\sputting\s(?<disable_interface>.+)\sin\s
EXTRACT-cisco_ios-pm_err_recover = ERR_RECOVER: Attempting to recover from (?<disable_cause>.+) err-disable state on (?<disable_interface>.+)
EXTRACT-cisco_ios-downgradedbw = (?:[^ \n]* ){9}%([^:]+)[^\(\n]*\((?P<vcd>[^\)]+)(?:[^ \n]* ){5}(?P<bw_down>\d+)k\s+(?P<bw_up>\d+)k
EXTRACT-cisco_ios-sw_matm_macflap_notif = MACFLAP_NOTIF: Host (?<src_mac>\S+) in vlan (?<src_vlan>\d+) is flapping between port (?<src_int>\S+) and port (?<dest_int>\S+)
EXTRACT-cisco_ios-c4k_ebm_hostflapping = HOSTFLAPPING: Host (?<src_mac>\S+) in vlan (?<src_vlan>\d+) is moving from port (?<src_int>\S+) to port (?<dest_int>\S+)

# STACKMGR
EXTRACT-cisco_ios-stackmgr_stack_link_change = STACK_LINK_CHANGE:\sStack\sPort\s(?<dest_int>\d+)\sSwitch\s(?<switch_id>\d+)\shas\schanged\sto\sstate\s(?<state_to>UP|DOWN)
EXTRACT-cisco-ios-stackmgr_switch_removed = SWITCH_REMOVED:\sSwitch\s(?<switch_id>\d+)\shas\sbeen\s(?<state_to>REMOVED|ADDED)\s(from|to)\sthe\sstack(\s\(?(?<switch>.+)\))?
EXTRACT-cisco-ios-stackmgr_switch_added = SWITCH_ADDED:\sSwitch\s(?<switch_id>\d+)\shas\sbeen\s(?<state_to>REMOVED|ADDED)\s(from|to)\sthe\sstack(\s\(?(?<switch>.+)\))?
EXTRACT-cisco-ios_stackmgr_switch_ready = SWITCH_READY: Switch (?<switch_id>\d+) is (?<state_to>\w+)(\s\(?(?<switch>.+)\))?
EXTRACT-cisco-ios_stackmgr_master_ready = MASTER_READY: Master Switch (?<switch_id>\d+) is (?<state_to>\w+)(\s\(?(?<switch>.+)\))?

# Spanning tree
EXTRACT-cisco_ios-spantree_loopguard = LOOPGUARD_(BLOCK|UNBLOCK): Loop guard (?<action>blocking|unblocking) port (?<dest_int>\S+) on (?<spanning_tree_instance>[A-Za-z0-9]+)
EXTRACT-cisco_ios-spantree_block_bpduguard = BLOCK_BPDUGUARD: Received BPDU on port (?<dest_int>\S+)

# Etherchannel
EXTRACT-cisco_ios-ec_cannot_bundle2 = CANNOT_BUNDLE2: (?<src_int>\S+) is (?<compatibility>not compatible) with (?<dest_int>\S+) and will be (?<action>\S+) \((?<reason>.+)\)
EXTRACT-cisco_ios-ec_compatible = COMPATIBLE: (?<src_int>\S+) is (?<compatibility>compatible) with port-channel members

EXTRACT-cisco_ios-config_change = %SYS-\d-CONFIG_I: Configured\sfrom\s(?<config_source>(?!memory).+)\sby\s(?<user>(?!snmp)\S+)(\s\on)?(\s)?(?<line>\w+)?(\s\()?(?<src_ip>[^\)]+)?\)?
# SNMP
EXTRACT-cisco_ios-config_change-2 = %SYS-\d-CONFIG_I: Configured\sfrom\s(?<config_source>memory)\sby\s(?<user>(?!snmp)\S+)(\s\((?<src_ip>[^\)]+)?\))?
EXTRACT-cisco_ios-config_change-3 = %SYS-\d-CONFIG_I: Configured\sfrom\s(?<src_ip>.+)\sby\s(?<config_source>snmp)
# Nexus config change
EXTRACT-cisco_ios-config_change-4 = %VSHD-\d-VSHD_SYSLOG_CONFIG_I: Configured from vty by (?<user>\S+) on (?<src_ip>\S+)@(?<config_source>.+)

EXTRACT-cisco_ios-reload = Reload\srequested\sby\s(?<user>\S+)\son\s(?<line>\w+)(\s\()?(?<src_ip>[^\)]+)?\)?.+Reload\sReason:\s(?<reason>.+).
EXTRACT-cisco_ios-restart = RESTART:\sSystem restarted --(\s\((?<switch_id>.+)\))? 
EXTRACT-cisco_ios-cfglog_loggedcmd = CFGLOG_LOGGEDCMD:\sUser:(?<user>\S+)\s\slogged\scommand:(?<command>.+)
EXTRACT-cisco_ios-authfail = AUTHFAIL: Authentication failure for SNMP req from host (?<src_ip>.+)
EXTRACT-cisco_ios-sec_login_login_success = %SEC_LOGIN-\d-LOGIN_SUCCESS: Login Success \[user: (?<user>\S+)\] \[Source: (?<src_ip>\S+)\] \[localport: (?<dest_port>\d+)\]
EXTRACT-cisco_ios-sec_login_login_failed = %SEC_LOGIN-\d-LOGIN_FAILED: Login failed \[user: (?<user>\S+)?\] \[Source: (?<src_ip>\S+)\] \[localport: (?<dest_port>\d+)\] \[Reason: (?<reason>.+)\]

# System messages
EXTRACT-cisco_ios-mallocfail = MALLOCFAIL:\sMemory\sallocation\sof\s(?<bytes>\d+)\sbytes\sfailed\sfrom\s(?<fail_from>0x[0-9a-fA-F]+),+\salignment\s(?<alignment>\d+)

# DHCP
EXTRACT-cisco_ios-dhcp_snooping_untrusted_port = DHCP_SNOOPING_UNTRUSTED_PORT:\s(?<char1>[A-Z_]+)\sdrop message on untrusted port, message type:\s(?<message_type>[A-Z_]+),\sMAC sa:\s(?<src_mac>[0-9a-fA-F]{4}.[0-9a-fA-F]{4}.[0-9a-fA-F]{4})
EXTRACT-cisco_ios-dhcp_snooping_fake_interface = DHCP_SNOOPING_FAKE_INTERFACE:\s(?<char1>[A-Z_]+)\sdrop message with mismatched source interface, the binding is not updated, message type:\s(?<message_type>[A-Z_]+),\sMAC sa:\s(?<src_mac>[0-9a-fA-F]{4}.[0-9a-fA-F]{4}.[0-9a-fA-F]{4})


# Routing
# OSPF
EXTRACT-cisco_ios-adjchg = ADJCHG:\sProcess\s(?<process_id>\d+),\sNbr\s(?<neighbor>\S+)\son\s(?<interface>\S+)\sfrom\s(?<state_from>DOWN|INIT|2WAY|EXSTART|EXCHANGE|LOADING|FULL)\sto\s(?<state_to>DOWN|INIT|2WAY|EXSTART|EXCHANGE|LOADING|FULL),\s(?<reason>.+)
# EIGRP
EXTRACT-cisco_ios-eigrp_nbrchange = NBRCHANGE:\s(?<protocol>IP|IPv6)-EIGRP\((?<process_id>\d+)\)\s(?<as_number>\d+):\sNeighbor\s(?<neighbor>\S+)\s\((?<interface>\S+)\)\sis\s(?<state_to>up|down):(?<reason>.+)
# EIGRP for IOS 15.0
EXTRACT-cisco_ios-eigrp_nbrchange-2 = NBRCHANGE:\s(EIGRP-(?<protocol>IPv4|IPv6))\s(?<as_number>\d+):\sNeighbor\s(?<neighbor>\S+)\s\((?<interface>\S+)\)\sis\s(?<state_to>up|down):(?<reason>.+)
# BGP
EXTRACT-cisco_ios-bgp_adjchange = ADJCHANGE:\sneighbor\s(?<neighbor>\S+)\s(vpn vrf\s(?<vrf>\S+)\s)?(?<state_to>Up|Down)(?<reason>\s.+)?
# MPLS LDP
EXTRACT-cisco_ios-ldp_nbrchg = NBRCHG:\s(?<protocol>TDP|LDP)\sNeighbor\s(?<neighbor>\S+):\d+(\s\((?<unknown_id>\d+)\))?\sis\s(?<state_to>UP|DOWN)(\s\((?<reason>.+)\))?

# Nexus
EXTRACT-cisco_ios-cdp_neighbor_added = NEIGHBOR_ADDED:\sDevice\s(?<cdp_remote_dvc>\S+)\((?<cdp_remote_dvc_serial>\S+)\)\sdiscovered\sof\stype\s(?<cdp_remote_dvc_type>\S+)\swith\sport\s(?<cdp_remote_int>\S+)\son\sincoming\sport\s(?<cdp_local_int>\S+)\swith\sip\saddr\s(?<cdp_remote_ip>\S+)\sand\smgmt\sip\s(?<cdp_remote_ip_mgmt>\S+)$
EXTRACT-cisco_ios-cdp_neighbor_removed = NEIGHBOR_REMOVED:\sCDP\sNeighbor\s(?<cdp_remote_dvc>\S+)\((?<cdp_remote_dvc_serial>\S+)\)\son\sport\s(?<cdp_local_int>\S+)\shas\sbeen\sremoved$
FIELDALIAS-cisco_ios-cdp_remote_ip = cdp_remote_ip AS src_ip


# ILPOWER (PoE)
REPORT-cisco_ios-ilpower = extract_cisco_ios-ilpower

# Wireless
REPORT-cisco_ios-lwapp_radio_crash = extract_cisco_ios-lwapp_radio_crash
REPORT-cisco_ios-lwapp_akita_err = extract_cisco_ios-lwapp_akita_err

# General normalization
FIELDALIAS-cisco_ios-acl_src_ip = acl_src_ip AS src_ip
FIELDALIAS-cisco_ios-acl_dst_ip = acl_dst_ip AS dest_ip
FIELDALIAS-cisco_ios-src_ip = src_ip AS src
FIELDALIAS-cisco_ios-dest_ip = dest_ip AS dest
FIELDALIAS-cisco_ios-acl_src_port = acl_src_port AS src_port
FIELDALIAS-cisco_ios-acl_dst_port = acl_dst_port AS dest_port

FIELDALIAS-cisco_ios-vlan = cdp_local_vlan AS src_vlan, cdp_remote_vlan AS dest_vlan
FIELDALIAS-cisco_ios-rule = acl_list AS rule
FIELDALIAS-cisco_ios-acl_proto = acl_proto AS protocol
FIELDALIAS-cisco_ios-transport = acl_proto AS transport
FIELDALIAS-cisco_ios-dvc = host AS dvc
