######################################################
#
# Cisco IOS
#
#
# Copyright (C) 2013 Mikael Bjerkeland
# All Rights Reserved
#
######################################################

[cisco:ios]
LOOKUP-cisco_ios-severity = cisco_ios_severity severity OUTPUT severity_description,severity_name
REPORT-cisco_ios-general = extract_cisco_ios-general
REPORT-cisco_ios-acl = extract_cisco_ios-acl
REPORT-cisco_ios-cdp_duplex_mismatch = extract_cisco_ios-duplex_mismatch
REPORT-cisco_ios-dot1x_auth = extract_cisco_ios-dot1x_auth
REPORT-cisco_ios-mab_auth = extract_cisco_ios-mab_auth 

EXTRACT-cisco_ios-cdp_native_vlan-mismatch = NATIVE_VLAN_MISMATCH:\sNative\sVLAN\smismatch\sdiscovered\son\s(?<cdp_local_interface>[^ ]+)\s\((?<cdp_local_vlan>\d+)\),\swith\s(?<cdp_neighbor>[^ ]+)\s(?<cdp_remote_interface>[^ ]+)\s\((?<cdp_remote_vlan>\d+)\)
EXTRACT-cisco_ios-port_flapping = Interface\s(?<interface>\S+),\schanged\sstate\sto\s(?<port_status>up|down)
EXTRACT-cisco_ios-err_disable = ERR_DISABLE:\s(?<disable_cause>.+)\serror\sdetected\s\on\s(?<detected_on_interface>.+),\sputting\s(?<disable_interface>.+)\sin\s
EXTRACT-cisco_ios-downgradedbw = (?:[^ \n]* ){9}%([^:]+)[^\(\n]*\((?P<vcd>[^\)]+)(?:[^ \n]* ){5}(?P<bw_down>\d+)k\s+(?P<bw_up>\d+)k

# STACKMGR
EXTRACT-cisco_ios-stackmgr_stack_link_change = STACK_LINK_CHANGE:\sStack\sPort\s(?<dest_int>\d+)\sSwitch\s(?<switch_id>\d+)\shas\schanged\sto\sstate\s(?<state_to>UP|DOWN)
EXTRACT-cisco-ios-stackmgr_switch_removed = SWITCH_REMOVED:\sSwitch\s(?<switch_id>\d+)\shas\sbeen\s(?<state_to>REMOVED|ADDED)\s(from|to)\sthe\sstack(\s\(?(?<switch>.+)\))?
EXTRACT-cisco-ios-stackmgr_switch_added = SWITCH_ADDED:\sSwitch\s(?<switch_id>\d+)\shas\sbeen\s(?<state_to>REMOVED|ADDED)\s(from|to)\sthe\sstack(\s\(?(?<switch>.+)\))?


EXTRACT-cisco_ios-config_change = Configured\sfrom\s(?<config_source>.+)\sby\s(?<user>(?!snmp)\S+)(\s\on)?(\s)?(?<line>\w+)?(\s\()?(?<src_ip>[^\)]+)?\)?
# SNMP
EXTRACT-cisco_ios-config_change-2 = Configured\sfrom\s(?<src_ip>.+)\sby\s(?<config_source>snmp)
EXTRACT-cisco_ios-reload = Reload\srequested\sby\s(?<user>\S+)\son\s(?<line>\w+)(\s\()?(?<src_ip>[^\)]+)?\)?.+Reload\sReason:\s(?<reason>.+).
EXTRACT-cisco_ios-cfglog_loggedcmd = CFGLOG_LOGGEDCMD:\sUser:(?<user>\S+)\s\slogged\scommand:(?<command>.+)


# System messages
EXTRACT-cisco_ios-mallocfail = MALLOCFAIL:\sMemory\sallocation\sof\s(?<bytes>\d+)\sbytes\sfailed\sfrom\s(?<fail_from>0x[0-9a-fA-F]+),+\salignment\s(?<alignment>\d+)

# DHCP
EXTRACT-cisco_ios-dhcp_snooping_untrusted_port = DHCP_SNOOPING_UNTRUSTED_PORT:\s(?<char1>[A-Z_]+)\sdrop message on untrusted port, message type:\s(?<message_type>[A-Z_]+),\sMAC sa:\s(?<src_mac>[0-9a-fA-F]{4}.[0-9a-fA-F]{4}.[0-9a-fA-F]{4})
EXTRACT-cisco_ios-dhcp_snooping_fake_interface = DHCP_SNOOPING_FAKE_INTERFACE:\s(?<char1>[A-Z_]+)\sdrop message with mismatched source interface, the binding is not updated, message type:\s(?<message_type>[A-Z_]+),\sMAC sa:\s(?<src_mac>[0-9a-fA-F]{4}.[0-9a-fA-F]{4}.[0-9a-fA-F]{4})


# Routing
# OSPF
EXTRACT-cisco_ios-adjchg = ADJCHG:\sProcess\s(?<process_id>\d+),\sNbr\s(?<neighbor>\S+)\son\s(?<interface>\S+)\sfrom\s(?<state_from>DOWN|INIT|2WAY|EXSTART|EXCHANGE|LOADING|FULL)\sto\s(?<state_to>DOWN|INIT|2WAY|EXSTART|EXCHANGE|LOADING|FULL),\s(?<reason>.+)
# EIGRP
EXTRACT-cisco_ios-eigrp_nbrchange = NBRCHANGE:\s(?<protocol>IP|IPv6)-EIGRP\((?<process_id>\d+)\)\s(?<as_number>\d+):\sNeighbor\s(?<neighbor>\S+)\s\((?<interface>\S+)\)\sis\s(?<state_to>up|down):(?<reason>.+)
# EIGRP for IOS 15.0
EXTRACT-cisco_ios-eigrp_nbrchange-2 = NBRCHANGE:\s(EIGRP-(?<protocol>IPv4|IPv6))\s(?<as_number>\d+):\sNeighbor\s(?<neighbor>\S+)\s\((?<interface>\S+)\)\sis\s(?<state_to>up|down):(?<reason>.+)
# BGP
EXTRACT-cisco_ios-bgp_adjchange = ADJCHANGE:\sneighbor\s(?<neighbor>\S+)\s(vpn vrf\s(?<vrf>\S+)\s)?(?<state_to>Up|Down)(?<reason>\s.+)?
# MPLS LDP
EXTRACT-cisco_ios-ldp_nbrchg = NBRCHG:\s(?<protocol>TDP|LDP)\sNeighbor\s(?<neighbor>\S+):\d+(\s\((?<unknown_id>\d+)\))?\sis\s(?<state_to>UP|DOWN)(\s\((?<reason>.+)\))?

# Nexus
EXTRACT-cisco_ios-cdp_neighbor_added = NEIGHBOR_ADDED:\sDevice\s(?<cdp_remote_dvc>\S+)\((?<cdp_remote_dvc_serial>\S+)\)\sdiscovered\sof\stype\s(?<cdp_remote_dvc_type>\S+)\swith\sport\s(?<cdp_remote_int>\S+)\son\sincoming\sport\s(?<cdp_local_int>\S+)\swith\sip\saddr\s(?<cdp_remote_ip>\S+)\sand\smgmt\sip\s(?<cdp_remote_ip_mgmt>\S+)$
EXTRACT-cisco_ios-cdp_neighbor_removed = NEIGHBOR_REMOVED:\sCDP\sNeighbor\s(?<cdp_remote_dvc>\S+)\((?<cdp_remote_dvc_serial>\S+)\)\son\sport\s(?<cdp_local_int>\S+)\shas\sbeen\sremoved$
FIELDALIAS-cisco_ios-cdp_remote_ip = cdp_remote_ip AS src_ip


# General normalization
FIELDALIAS-cisco_ios-src_ip = src_ip AS src
FIELDALIAS-cisco_ios-vlan = cdp_local_vlan AS src_vlan, cdp_remote_vlan AS dest_vlan
